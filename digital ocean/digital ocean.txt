personal access token:
----------
name:
ben-token
token:
3ee16a31ea5cf3c5d3c788be4b6fc7a6ae56ff4de81253269be06e8ff55a95b4




------------------------------------------
to spin up a nodejs server------------------------------------------
------------------------------------------

-start digital ocean droplet with node.js image package
-ssh in and install forever:
npm install -g forever
-add a deploy user so that you're not using root all the time:
https://gist.github.com/learncodeacademy/3cdb928c9314f98404d0

sudo useradd --create-home -s /bin/bash deploy
sudo adduser deploy sudo
sudo passwd deploy

-ssh in as that new user--------
-setup passwordless ssh:
mkdir .ssh
exit
Push your ssh key to the authorized_keys file on the remote server
cat ~/.ssh/id_rsa.pub | ssh deploy@159.203.10.251 "mkdir -p ~/.ssh && cat >>  ~/.ssh/authorized_keys"

Generate an SSH keypair for passwordless SSH:---------

instructions here:
https://www.youtube.com/watch?v=DbPDraCYju8
and here:
https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2

#on your computer
cd ~/.ssh
#you might need to make the .ssh directory
ssh-keygen -C "my@email.com"
#hit enter a few times to generate key

#copy the file contents to the clipboard
cat id_rsa.pub | pbcopy

#log into your machine
ssh user@mydomain.com
#make the .ssh directory and get in it
mkdir .ssh
cd .ssh
#open authorized_keys in nano and paste the contents in
nano authorized_keys
#paste contents in and save by hitting ctrl+x

#exit and you can now ssh without a password!


Automate our deployment using flightplan (node module)---------

first make sure your node preject is a git repository, instructions here:
https://www.youtube.com/watch?v=vmekjPhQuCc
instructions here:
https://gist.github.com/learncodeacademy/393c8ec3ebaa92df9a29
and
https://gist.github.com/learncodeacademy/35045e64d2bbe6eb14f9

on your machine:
npm install -g forever

then in your node project folder:
npm install flightplan --save-dev

do deploy just run:
fly staging or fly production
(since we have no staging server just do fly production)

note:
it needs rsync to work and you need to install that:
https://www.itefix.net/content/cwrsync-free-edition
(set environment variables on windows for it to work):
http://stackoverflow.com/questions/20493309/cwrsync-in-windows-not-being-recognised



---------------------------------------------------

WORKING SETUP FOR NODE APP SERVER WITH NGINX REVERSE PROXY SERVER

** make sure you ebable private networking when creating both droplets
if you forgot, run these steps:
https://www.digitalocean.com/community/tutorials/how-to-enable-digitalocean-private-networking-on-existing-droplets


APP SERVER -------------------
--------------------------------
ubuntu-14-04-512mb-node-appserver server

did this first for ssh keys setup:
https://www.digitalocean.com/community/tutorials/how-to-use-ssh-keys-with-digitalocean-droplets

ip:
159.203.1.11

ssh key: id_rsa
ssh key passphrase: 
k00l543
(same for all droplets)
Username: root
no password

ssh root@159.203.1.11

installed ftp:
https://anotherguru.me/how-to-install-vsftpd-on-ubuntu-14-04-on-digitalocean-droplet/

FTP:
host:
159.203.1.11
root

private ip (for networking with webserver)
10.137.32.58

enable private ipv4 network on this droplet
through control panel



ran this already:
https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-14-04


adduser ben

user:
ben
pass
k00l543345vgbd345

gpasswd -a ben sudo

which give user ben super user prvivilages by adding to the sudo group

now ssh out of root and into the new user
ssh ben@159.203.1.11 -p 22

install mysql:
https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-14-04

and to secrue it:
https://www.digitalocean.com/community/tutorials/how-to-secure-mysql-and-mariadb-databases-in-a-linux-vps

MYSQL--------------
root user name is changed to:
adminroot
pass:
HY^&4^$#gdh

user:
ben
pass:
HY^&4^$#gdh

commands:
create database test3;
CREATE USER 'ben'@'localhost' IDENTIFIED BY 'HY^&4^$#gdh';
GRANT ALL ON test3.* TO 'ben'@'localhost';
show grants for 'ben'@'localhost';
rename user 'root'@'localhost' to 'adminroot'@'localhost';

install nodemon:
npm install -g nodemon

WEB SERVER -------------------
--------------------------------
ubuntu-14-04-512mb-node-webserver

ip:
159.203.63.238

ssh root@159.203.63.238

ran this already:
https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-14-04


adduser ben

user:
ben
pass
k00l543345vgbd345

gpasswd -a ben sudo

ssh ben@159.203.63.238 -p 22

INSTALLING NODE SETUP -------------------
--------------------------------

Follow this:
https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-14-04

important notes: 
-instructions for sudo mv node /opt/ should be /opt/node
-also you must restart both machines for everything to work

preview your work here:
159.203.63.238















